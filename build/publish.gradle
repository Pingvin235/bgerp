task publishUpdate(type: JavaExec, dependsOn: ['compileToolJava', 'touchChanges'], description: 'Copies changes modules to be available under https://bgerp.org/update') {
    mustRunAfter 'doc'
    mustRunAfter 'buildUpdate'
    mustRunAfter 'buildUpdateLib'
    classpath =  sourceSets.tool.runtimeClasspath
    mainClass = 'org.bgerp.tool.PublishUpdate'
    args "$buildDir/$distsDirName", version, "${->getChangeIdOrThrow()}"
}

task publishRelease(type: JavaExec, dependsOn: 'compileToolJava', description: 'Copies distribution, update and update_lib packages to CDN server') {
    mustRunAfter 'buildUpdate'
    mustRunAfter 'buildUpdateLib'
    mustRunAfter 'patchChanges'
    mustRunAfter 'rss'
    classpath =  sourceSets.tool.runtimeClasspath
    mainClass = 'org.bgerp.tool.PublishRelease'
    args "$buildDir/$distsDirName", version, "${->getBuild()}"
}

task publishCommit(type: Exec, description: 'Pushes changes in master branch to GIT') {
    mustRunAfter 'updateProperties'
    mustRunAfter 'updatePropertiesLib'
    mustRunAfter 'patchChanges'
    mustRunAfter 'rss'
    workingDir "$projectDir/build"
    commandLine 'git', 'commit', '*.properties', 'changes.txt', 'changes.*.txt', "-m PUBLISH ${->getBuild()}"
}
